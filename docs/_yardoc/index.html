<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.37
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-Harmoniser">Harmoniser</h1>

<p><a href="https://badge.fury.io/rb/harmoniser"><img src="https://badge.fury.io/rb/harmoniser.svg"></a> <img src="https://github.com/jollopre/harmoniser/actions/workflows/ci.yml/badge.svg"></p>

<p>Harmoniser is a minimalistic approach to interact with the RabbitMQ implementation of <a href="https://www.rabbitmq.com/amqp-0-9-1-reference.html">AMQP 0-9-1</a> through <a href="https://github.com/ruby-amqp/bunny">Bunny</a>.</p>
<ul><li>
<p>Harmoniser provides a long-lived <a href="https://www.rabbitmq.com/connections.html">connection</a> to RabbitMQ for efficient publishing and consuming of messages.</p>
</li><li>
<p>Harmoniser issues a thread-safe dedicated <a href="https://www.rabbitmq.com/channels.html">channel</a> for each publish/consume use case defined.</p>
</li><li>
<p>Harmoniser offers a concise DSL to differentiate topology definition from other actions such as publishing or consuming.</p>
</li><li>
<p>Harmoniser may run as a dedicated Ruby Process through its <a href="https://github.com/jollopre/harmoniser/wiki/Harmoniser-CLI">CLI</a> as well as a part of other processes like Puma, Unicorn, Sidekiq, or similar.</p>
</li></ul>

<h2 id="label-Getting+Started">Getting Started</h2>
<ol><li>
<p>Add this line to your applicationâ€™s Gemfile:</p>
</li></ol>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>harmoniser</span><span class='tstring_end'>&quot;</span></span>
</code></pre>
<ol><li>
<p>Install the gem:</p>
</li></ol>

<pre class="code ruby"><code class="ruby">$ bundle install
</code></pre>
<ol><li>
<p>Include <code>Harmoniser::Publisher</code> and/or <code>Harmoniser::Subscriber</code> in your classes. For instance, in <a href="examples/multicast_rb.html">this scenario</a>, it is assumed that you would like to run publishers and subscribers under the same process.</p>
</li><li>
<p>(Optional) Run Harmoniser CLI in order to process messages from your subscribers:</p>
</li></ol>

<pre class="code ruby"><code class="ruby">$ bundle exec harmoniser --require ./examples/multicast.rb
</code></pre>
<ol><li>
<p>Inspect the logs to see if everything worked as expected. Look for logs containing <code>harmoniser@</code>.</p>
</li></ol>

<h2 id="label-Concepts">Concepts</h2>

<p>Harmoniser is a library for publishing/consuming messages through RabbitMQ. It enables not only the connection of applications but also the scaling of an application by performing work in the background. This gem is comprised of three parts:</p>

<h3 id="label-Publisher">Publisher</h3>

<p>The Publisher runs in any Ruby process (puma, unicorn, passenger, sidekiq, etc) and enables you to push messages through a <a href="https://www.rabbitmq.com/tutorials/amqp-concepts.html#exchanges">RabbitMQ Exchange</a>. Creating a publisher is as simple as:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>harmoniser</span><span class='tstring_end'>&quot;</span></span>

<span class='kw'>class</span> <span class='const'>MyPublisher</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Harmoniser.html" title="Harmoniser (module)">Harmoniser</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Harmoniser/Publisher.html" title="Harmoniser::Publisher (module)">Publisher</a></span></span>
  <span class='id identifier rubyid_harmoniser_publisher'>harmoniser_publisher</span> <span class='label'>exchange_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_topic_exchange</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='const'>MyPublisher</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='label'>salute:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello World!</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span><span class='comma'>,</span> <span class='label'>routing_key:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_resource.foo.bar</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
</code></pre>

<p>The code above assumes that the exchange is already defined. We would like to emphasize that defining RabbitMQ topology (exchanges, queues and bindings) should be performed outside of the class whose role is purely focused on publishing. For more details on how to define the topology, refer to <a href="examples/multicast_rb.html#L11-L19">this example</a>.</p>

<h3 id="label-RabbitMQ">RabbitMQ</h3>

<p>RabbitMQ is the message broker used to publish/consume messages through Harmoniser. It can be configured using <code>Harmoniser.configure</code> as follows:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>harmoniser</span><span class='tstring_end'>&quot;</span></span>

<span class='const'><span class='object_link'><a href="Harmoniser.html" title="Harmoniser (module)">Harmoniser</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'><span class='object_link'><a href="Harmoniser/Configurable.html#configure-instance_method" title="Harmoniser::Configurable#configure (method)">configure</a></span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_config'>config</span><span class='op'>|</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_connection_opts'>connection_opts</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='label'>host:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rabbitmq</span><span class='tstring_end'>&quot;</span></span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</code></pre>

<p>The options permitted for <code>connection_opts</code> are those accepted by <a href="https://github.com/ruby-amqp/bunny/blob/main/docs/guides/connecting.md#using-a-map-of-parameters">Bunny</a> since Harmoniser is built on top of the widely used Ruby client for RabbitMQ.</p>

<h3 id="label-Harmoniser+Server">Harmoniser Server</h3>

<p>Harmoniser server is a process specifically dedicated to running Subscribers that listen to <a href="https://www.rabbitmq.com/tutorials/amqp-concepts.html#queues">Rabbit Queues</a>. Like any other Ruby process (puma, unicorn, passenger, sidekiq, etc), Harmoniser remains up and running unless OS Signals such as SIGINT or SIGTERM are sent to it. During boot time, the server can register each class from your code that includes <code>Harmoniser::Subscriber</code> module. Creating a subscriber is as simple as:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>MySubscriber</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Harmoniser.html" title="Harmoniser (module)">Harmoniser</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Harmoniser/Subscriber.html" title="Harmoniser::Subscriber (module)">Subscriber</a></span></span>
  <span class='id identifier rubyid_harmoniser_subscriber'>harmoniser_subscriber</span> <span class='label'>queue_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_queue</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</code></pre>

<p>The code above assumes that the queue and its binding to an exchange are already defined. You can find more details about how this is specified <a href="examples/multicast_rb.html#L11-L19">here</a>.</p>

<p>To enable subscribers to receive messages from a queue, you should spin up a dedicated Ruby process as follows:</p>

<pre class="code ruby"><code class="ruby">$ bundle exec harmoniser --require ./a_path_to_your_ruby_file.rb
</code></pre>

<p>For more information about the various options accepted by the Harmoniser process, refer to the <a href="https://github.com/jollopre/harmoniser/wiki/Harmoniser-CLI">Harmoniser CLI documentation</a>.</p>

<h2 id="label-Contributing">Contributing</h2>

<p>If you are facing issues that you suspect are related to Harmoniser, please consider opening an issue <a href="https://github.com/jollopre/harmoniser/issues">here</a>. Remember to include as much information as possible such as version of Ruby, Rails, Harmoniser, OS, etc.</p>

<p>If you believe you have encountered a potential bug, providing detailed information about how to reproduce it can greatly expedite the fix.</p>

<h3 id="label-Code">Code</h3>

<p>To contribute to this codebase, you will need to setup your local development using the following steps:</p>

<pre class="code ruby"><code class="ruby"># Prepare the environment for working locally.
  $ make build
# Perform the desired changes into your local copy
  $ make test
</code></pre>

<p>You can also access the running container by executing <code>$ make shell</code> and then execute any commands related to Harmoniser within its isolated environment.</p>

<h2 id="label-License">License</h2>

<p>The gem is available as open source under the terms of the <a href="https://opensource.org/licenses/MIT">MIT License</a>.</p>

<h2 id="label-Author">Author</h2>

<p>Jose Lloret, <a href="mailto:jollopre@gmail.com">jollopre@gmail.com</a></p>
</div></div>

      <div id="footer">
  Generated on Sat Apr  5 21:33:46 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.3.4).
</div>

    </div>
  </body>
</html>